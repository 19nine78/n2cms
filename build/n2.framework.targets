<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">

	<!-- Framework -->

	<Target Name="Framework-PrepareDependencies">
		<Copy SourceFiles="@(Framework-Dependencies)" DestinationFolder="$(WebFolder)\Bin\" />
	</Target>

	<Target Name="Framework-Build" DependsOnTargets="Framework-PrepareDependencies">
		<MSBuild Projects="$(SrcFolder)\N2.Sources-vs2008.sln" Properties="Configuration=$(Configuration);NHVersion=$(NHVersion)" />
	</Target>

	<ItemGroup>
		<Framework-Dependencies Include="$(LibFolder)\Castle*;
									$(LibFolder)\Iesi.Collections.dll;
									$(LibFolder)\log4net.dll;
									$(LibFolder)\NHibernate.dll;
									$(LibFolder)\NHibernate.Caches.SysCache2.dll;
									$(LibFolder)\System.Data.SQLite.dll"/>

		<TextFiles Include="$(DocFolder)\history.txt;
							$(DocFolder)\install.txt;
							$(DocFolder)\license.txt;
							$(DocFolder)\n2_readme.txt;
							$(DocFolder)\example.web.config" />

		<Snippets Include="$(SnippetsFolder)\*" />
	</ItemGroup>

	<Target Name="Rebuild-Framework-BinFiles" DependsOnTargets="Framework-Build">
		<ItemGroup>
			<Framework-EditFiles Include="$(EditFolder)\**\*.as?x;
									 $(EditFolder)\**\*.master;
									 $(EditFolder)\**\*.resx;
									 $(EditFolder)\**\*.config;
									 $(EditFolder)\**\*.css;
									 $(EditFolder)\**\*.js;
									 $(EditFolder)\**\*.gif;$(EditFolder)\**\*.png;$(EditFolder)\**\*.jpg;$(EditFolder)\**\*.png;
									 $(EditFolder)\**\*.htm;$(EditFolder)\**\*.html"/>
		</ItemGroup>
		<CreateItem Include="$(WebFolder)\Bin\*.dll;
							 $(WebFolder)\Bin\N2.xml;"
					Exclude="$(WebFolder)\Bin\N2.Templates*;
							 $(WebFolder)\Bin\AddonCatalog*;
							 $(WebFolder)\Bin\Demo*;
							 $(WebFolder)\Bin\MyAddon*;
							 $(WebFolder)\Bin\n2markdown*;
							 $(WebFolder)\Bin\Scrum*;
							 $(WebFolder)\Bin\TabPanel*;
							 $(WebFolder)\Bin\Tagging*;
							 $(WebFolder)\Bin\Wiki*;">
			<Output TaskParameter="Include" ItemName="Framework-BinFiles"/>
		</CreateItem>
	</Target>

	<Target Name="Framework-Deploy" DependsOnTargets="Rebuild-Framework-BinFiles">
		<Copy SourceFiles="@(Framework-BinFiles)" DestinationFolder="$(DeployFolder)\Framework\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)" DestinationFolder="$(DeployFolder)\Framework\Edit\%(RecursiveDir)" />
		<Copy SourceFiles="@(TextFiles)" DestinationFolder="$(DeployFolder)\Framework" />
	</Target>

</Project>