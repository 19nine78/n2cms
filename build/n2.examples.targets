<?xml version="1.0" encoding="utf-8" ?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">

	<!-- EXAMPLES -->

	<PropertyGroup>
		<Examples-VB-SourceFolder>$(Examples-Folder)\MinimalVisualBasic</Examples-VB-SourceFolder>
		<Examples-CS-SourceFolder>$(Examples-Folder)\MinimalCSharp</Examples-CS-SourceFolder>
		<Examples-Mvc-SourceFolder>$(Examples-Folder)\Mvc</Examples-Mvc-SourceFolder>
		<Examples-Templates-SourceFolder>$(Examples-Folder)\TemplatesSite</Examples-Templates-SourceFolder>

		<Example-CS-DeployFolder>$(DeployFolder)\Example_CS</Example-CS-DeployFolder>
		<Example-VB-DeployFolder>$(DeployFolder)\Example_VB</Example-VB-DeployFolder>
		<Example-Templates-DeployFolder>$(DeployFolder)\Example_TemplatesIntegration</Example-Templates-DeployFolder>
		<Example-Mvc-DeployFolder>$(DeployFolder)\Example_Mvc</Example-Mvc-DeployFolder>
	</PropertyGroup>

	<!-- Prepare dependencies -->
	
	<Target Name="Examples-PrepareDependencies" DependsOnTargets="Prepare-Examples-CSharp;Prepare-Examples-VisualBasic;Prepare-Examples-Mvc;Prepare-Examples-TemplatesSite">
		<!--<CallTarget Targets="Examples-CSharp-PrepareDependencies;
							 Examples-VisualBasic-PrepareDependencies;
							 Examples-TemplatesSite-PrepareDependencies;
							 Examples-Mvc-PrepareDependencies"/>-->
	</Target>

	<Target Name="Examples-CSharp-PrepareDependencies" DependsOnTargets="Framework-CreateItemGroups">
		<Copy SourceFiles="@(Framework-BinFiles)" DestinationFolder="$(Examples-CS-SourceFolder)\wwwroot\bin" />
		<Copy SourceFiles="@(Framework-EditFiles)" DestinationFolder="$(Examples-CS-SourceFolder)\wwwroot\N2\%(RecursiveDir)" />
	</Target>
	<Target Name="Examples-VisualBasic-PrepareDependencies" DependsOnTargets="Framework-CreateItemGroups">
		<Copy SourceFiles="@(Framework-BinFiles)" DestinationFolder="$(Examples-VB-SourceFolder)\wwwroot\bin" />
		<Copy SourceFiles="@(Framework-EditFiles)" DestinationFolder="$(Examples-VB-SourceFolder)\wwwroot\N2\%(RecursiveDir)" />
	</Target>
	<Target Name="Examples-TemplatesSite-PrepareDependencies" DependsOnTargets="Framework-CreateItemGroups;Templates-Deploy">
		<ItemGroup>
			<_TemplatesFiles Include="$(DeployFolder)\Templates_WebForms\wwwroot\**\*" />
		</ItemGroup>
		<Copy SourceFiles="@(Framework-BinFiles)" DestinationFolder="$(Examples-Templates-SourceFolder)\wwwroot\bin" />
		<Copy SourceFiles="@(_TemplatesFiles)" DestinationFolder="$(Examples-Templates-SourceFolder)\wwwroot\%(RecursiveDir)" />
		<Copy SourceFiles="@(Framework-EditFiles)" DestinationFolder="$(Examples-Templates-SourceFolder)\wwwroot\N2\%(RecursiveDir)" />
	</Target>
	<Target Name="Examples-Mvc-PrepareDependencies" DependsOnTargets="Framework-CreateItemGroups">
		<Copy SourceFiles="$(SrcFolder)\N2.Extensions\bin\$(Configuration)\N2.Extensions.dll; 
                       $(LibFolder)\Microsoft.Web.Mvc.dll; 
                       $(LibFolder)\System.Web.Mvc.dll;"
					DestinationFolder="$(Examples-Mvc-SourceFolder)\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-BinFiles)" DestinationFolder="$(Examples-Mvc-SourceFolder)\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)" DestinationFolder="$(Examples-Mvc-SourceFolder)\wwwroot\N2\%(RecursiveDir)" SkipUnchangedFiles="true" />
	</Target>

	<!-- Build -->

	<Target Name="Examples-Build">
		<CallTarget Targets="Example-SimpleCSharp-Build; 
							 Example-SimpleVisualBasic-Build; 
							 Examples-Mvc-Build"/>
	</Target>

	<Target Name="Example-SimpleCSharp-Build" DependsOnTargets="Examples-CSharp-PrepareDependencies">
		<MSBuild Projects="$(Examples-CS-SourceFolder)\CSharp_Example-vs2008.sln"/>
	</Target>
	<Target Name="Example-SimpleVisualBasic-Build" DependsOnTargets="Examples-VisualBasic-PrepareDependencies">
		<MSBuild Projects="$(Examples-VB-SourceFolder)\VisualBasic_Example-vs2008.sln"/>
	</Target>
	<Target Name="Examples-TemplatesSite-Build" DependsOnTargets="Examples-TemplatesSite-PrepareDependencies">
		<MSBuild Projects="$(Examples-Templates-SourceFolder)\MyProject-vs2008.sln" />
	</Target>
	<Target Name="Examples-Mvc-Build" DependsOnTargets="Examples-Mvc-PrepareDependencies">
		<MSBuild Projects="$(Examples-Mvc-SourceFolder)\Mvc_Example.sln" />
	</Target>
	
	<!-- Clean -->
	
	<Target Name="Examples-Clean">
		<MSBuild Projects="$(Examples-Folder)\N2.Examples-vs2008.sln" Targets="Clean" />
		<MSBuild Projects="$(Examples-Folder)\N2.Examples-VisualBasic.sln" Targets="Clean" />

		<ItemGroup>
			<DependencyFolders Include="$(Examples-Folder)\MinimalCSharp\wwwroot\N2\;
									    $(Examples-Folder)\MinimalVisualBasic\wwwroot\N2\;
									    $(Examples-Folder)\Mvc\wwwroot\N2\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\App_Browsers\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\App_GlobalResources\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\App_Themes\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\Templates\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\Upload\;"/>
			<BinFiles Include="$(Examples-Folder)\**\bin\*" />
		</ItemGroup>
		<RemoveDir Directories="@(DependencyFolders)" />
		<Delete Files="@(BinFiles)" />
	</Target>

	<!-- Deploy -->
	
	<Target Name="Examples-Deploy">
		<CallTarget Targets="Examples-VB-Deploy;
							 Examples-CS-Deploy;
							 Examples-TemplatesSite-Deploy;
							 Examples-Mvc-Deploy" />
	</Target>

	<Target Name="Examples-Zip" DependsOnTargets="Examples-Deploy">
		<ItemGroup>
			<ZipDeploy-CSExample Include="$(Example-CS-DeployFolder)\**" />
			<ZipDeploy-VBExample Include="$(Example-VB-DeployFolder)\**" />
			<ZipDeploy-TemplateExample Include="$(Example-Templates-DeployFolder)\**" />
			<ZipDeploy-MvcExample Include="$(Example-Mvc-DeployFolder)\**" />
		</ItemGroup>

		<Error Condition="'@(ZipDeploy-CSExample)' == ''" Text="Nothing in '$(Example-CS-DeployFolder)'. Do deploy first." />
		<Error Condition="'@(ZipDeploy-VBExample)' == ''" Text="Nothing in '$(Example-VB-DeployFolder)'. Do deploy first." />
		<Error Condition="'@(ZipDeploy-TemplateExample)' == ''" Text="Nothing in '$(Example-Templates-DeployFolder)'. Do deploy first." />
		<Error Condition="'@(ZipDeploy-MvcExample)' == ''" Text="Nothing in '$(Example-Mvc-DeployFolder)'. Do deploy first." />

		<Zip Files="@(ZipDeploy-CSExample)"       WorkingDirectory="$(Example-CS-DeployFolder)"				ZipFileName="$(Example-CS-DeployFolder).zip" />
		<Zip Files="@(ZipDeploy-VBExample)"       WorkingDirectory="$(Example-VB-DeployFolder)"				ZipFileName="$(Example-VB-DeployFolder).zip" />
		<Zip Files="@(ZipDeploy-TemplateExample)" WorkingDirectory="$(Example-Templates-DeployFolder)" ZipFileName="$(Example-Templates-DeployFolder).zip" />
		<Zip Files="@(ZipDeploy-MvcExample)"      WorkingDirectory="$(Example-Mvc-DeployFolder)"			ZipFileName="$(Example-Mvc-DeployFolder).zip" />
	</Target>

	<Target Name="Examples-VB-Deploy" DependsOnTargets="Examples-CreateItemGroups">
		<ItemGroup>
			<ExampleSource-VBFiles Include="$(Examples-VB-SourceFolder)\**\*.*" Exclude="@(ExampleSource-Exclude)" />
		</ItemGroup>
		<Copy SourceFiles="@(ExampleSource-VBFiles)" DestinationFolder="$(Example-VB-DeployFolder)\%(RecursiveDir)" />
		<Copy SourceFiles="@(Framework-BinFiles)"    DestinationFolder="$(Example-VB-DeployFolder)\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)"   DestinationFolder="$(Example-VB-DeployFolder)\wwwroot\N2\%(RecursiveDir)" />
		<Copy SourceFiles="@(TextFiles)"             DestinationFolder="$(Example-VB-DeployFolder)" />
	</Target>
	
	<Target Name="Examples-CS-Deploy" DependsOnTargets="Examples-CreateItemGroups">
		<ItemGroup>
			<ExampleSource-CSFiles Include="$(Examples-CS-SourceFolder)\**\*.*" Exclude="@(ExampleSource-Exclude)" />
		</ItemGroup>
		<Copy SourceFiles="@(ExampleSource-CSFiles)" DestinationFolder="$(Example-CS-DeployFolder)\%(RecursiveDir)" />
		<Copy SourceFiles="@(Framework-BinFiles)"    DestinationFolder="$(Example-CS-DeployFolder)\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)"   DestinationFolder="$(Example-CS-DeployFolder)\wwwroot\N2\%(RecursiveDir)" />
		<Copy SourceFiles="@(TextFiles)"             DestinationFolder="$(Example-CS-DeployFolder)" />
		<Copy SourceFiles="@(Snippets)"              DestinationFolder="$(Example-CS-DeployFolder)\Snippets" />
	</Target>
	
	<Target Name="Examples-TemplatesSite-Deploy" DependsOnTargets="Examples-CreateItemGroups">
		<ItemGroup>
			<ExampleSource-TemplatesSiteFiles Include="$(Examples-Templates-SourceFolder)\**\*.*" Exclude="@(ExampleSource-Exclude)" />
		</ItemGroup>
		<Copy SourceFiles="@(ExampleSource-TemplatesSiteFiles)" DestinationFolder="$(Example-Templates-DeployFolder)\%(RecursiveDir)" />
		<Copy SourceFiles="@(Framework-BinFiles)"								DestinationFolder="$(Example-Templates-DeployFolder)\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)"							DestinationFolder="$(Example-Templates-DeployFolder)\wwwroot\N2\%(RecursiveDir)" />
		<Copy SourceFiles="@(TextFiles)"                        DestinationFolder="$(Example-Templates-DeployFolder)" />
		<Copy SourceFiles="@(Snippets)"                         DestinationFolder="$(Example-Templates-DeployFolder)\Snippets" />
	</Target>
	
	<Target Name="Examples-Mvc-Deploy" DependsOnTargets="Examples-CreateItemGroups">
		<ItemGroup>
			<ExampleSource-MvcFiles Include="$(Examples-Mvc-SourceFolder)\**\*.*" Exclude="@(ExampleSource-Exclude)" />
		</ItemGroup>
		<Copy SourceFiles="@(ExampleSource-MvcFiles)"       DestinationFolder="$(Example-Mvc-DeployFolder)\%(RecursiveDir)" />
		<Copy SourceFiles="@(Framework-BinFiles)"           DestinationFolder="$(Example-Mvc-DeployFolder)\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)"          DestinationFolder="$(Example-Mvc-DeployFolder)\wwwroot\N2\%(RecursiveDir)" />
		<Copy SourceFiles="@(TextFiles)"                    DestinationFolder="$(Example-Mvc-DeployFolder)" />
		<Copy SourceFiles="@(Snippets)"                     DestinationFolder="$(Example-Mvc-DeployFolder)\Snippets" />
	</Target>

	<Target Name="Examples-CreateItemGroups" DependsOnTargets="Framework-CreateItemGroups">
		<ItemGroup>
			<ExampleSource-Exclude Include="$(Examples-Folder)\**\N2\**\*;
											$(Examples-Folder)\**\.svn\**\*;
											$(Examples-Folder)\**\_*\**\*;
											$(Examples-Folder)\**\*WebSetup\**\*;
											$(Examples-Folder)\**\*VsTemplate\**\*;
											$(Examples-Folder)\**\obj\**\*;
											$(Examples-Folder)\**\PrecompiledWeb\**\*.*;
											$(Examples-Folder)\**\Ankh.Load;
											$(Examples-Folder)\**\*.sln.cache;
											$(Examples-Folder)\**\*.suo;
											$(Examples-Folder)\**\*.resharper;
											$(Examples-Folder)\**\*.user;
											$(Examples-Folder)\**\bin\Debug\*.*;
											$(Examples-Folder)\**\bin\Release\*.*;
											$(Examples-Folder)\**\*.pdb;
											$(Examples-Folder)\**\*WithProjectReferences.*" />
		</ItemGroup>
	</Target>

</Project>