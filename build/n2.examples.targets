<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">

	<!-- EXAMPLES -->

	<PropertyGroup>
		<Examples-VisualBasic>$(Examples-Folder)\MinimalVisualBasic</Examples-VisualBasic>
		<Examples-CSharp>$(Examples-Folder)\MinimalCSharp</Examples-CSharp>
		<Examples-MvcFolder>$(Examples-Folder)\Mvc</Examples-MvcFolder>
		<Examples-TemplatesSiteFolder>$(Examples-Folder)\TemplatesSite</Examples-TemplatesSiteFolder>
		<Deploy-ExamplesFolder>$(DeployFolder)\Examples</Deploy-ExamplesFolder>
	</PropertyGroup>

	<Target Name="Examples-CSharp-PrepareDependencies" DependsOnTargets="Rebuild-Framework-BinFiles">
		<Copy SourceFiles="@(Framework-BinFiles)" DestinationFolder="$(Examples-CSharp)\wwwroot\bin" />
		<Copy SourceFiles="@(Framework-EditFiles)" DestinationFolder="$(Examples-CSharp)\wwwroot\Edit\%(RecursiveDir)" />
	</Target>
	<Target Name="Examples-VisualBasic-PrepareDependencies" DependsOnTargets="Rebuild-Framework-BinFiles">
		<Copy SourceFiles="@(Framework-BinFiles)" DestinationFolder="$(Examples-VisualBasic)\wwwroot\bin" />
		<Copy SourceFiles="@(Framework-EditFiles)" DestinationFolder="$(Examples-VisualBasic)\wwwroot\Edit\%(RecursiveDir)" />
	</Target>
	<Target Name="Examples-TemplatesSite-PrepareDependencies" DependsOnTargets="Rebuild-Framework-BinFiles;Templates-Deploy">
		<ItemGroup>
			<_TemplatesFiles Include="$(DeployFolder)\Templates\wwwroot\**\*" />
		</ItemGroup>
		<Copy SourceFiles="@(Framework-BinFiles)" DestinationFolder="$(Examples-TemplatesSiteFolder)\wwwroot\bin" />
		<Copy SourceFiles="@(_TemplatesFiles)" DestinationFolder="$(Examples-TemplatesSiteFolder)\wwwroot\%(RecursiveDir)" />
	</Target>
	<Target Name="Examples-Mvc-PrepareDependencies" DependsOnTargets="Rebuild-Framework-BinFiles">
		<Copy SourceFiles="$(SrcFolder)\N2.Extensions\bin\N2.Extensions.dll; 
                       $(LibFolder)\Microsoft.Web.Mvc.dll; 
                       $(LibFolder)\System.Web.Mvc.dll;"
					DestinationFolder="$(Examples-MvcFolder)\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-BinFiles)" DestinationFolder="$(Examples-MvcFolder)\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)" DestinationFolder="$(Examples-MvcFolder)\wwwroot\Edit\%(RecursiveDir)" SkipUnchangedFiles="true" />
	</Target>

	<Target Name="Examples-PrepareDependencies">
		<CallTarget Targets="Examples-CSharp-PrepareDependencies"/>
		<CallTarget Targets="Examples-VisualBasic-PrepareDependencies"/>
		<CallTarget Targets="Examples-TemplatesSite-PrepareDependencies"/>
		<CallTarget Targets="Examples-Mvc-PrepareDependencies"/>
	</Target>

	<Target Name="Example-SimpleCSharp-Build" DependsOnTargets="Examples-CSharp-PrepareDependencies">
		<MSBuild Projects="$(Examples-CSharp)\CSharp_Example-vs2008.sln"/>
	</Target>
	<Target Name="Example-SimpleVisualBasic-Build" DependsOnTargets="Examples-VisualBasic-PrepareDependencies">
		<MSBuild Projects="$(Examples-VisualBasic)\VisualBasic_Example-vs2008.sln"/>
	</Target>
	<Target Name="Examples-TemplatesSite-Build" DependsOnTargets="Examples-TemplatesSite-PrepareDependencies">
		<MSBuild Projects="$(Examples-TemplatesSiteFolder)\MyProject-vs2008.sln" />
	</Target>
	<Target Name="Examples-Mvc-Build" DependsOnTargets="Examples-Mvc-PrepareDependencies">
		<MSBuild Projects="$(Examples-MvcFolder)\Mvc_Example.sln" />
	</Target>

	<Target Name="Examples-Build">
		<CallTarget Targets="Example-SimpleCSharp-Build; Example-SimpleVisualBasic-Build; Examples-Mvc-Build"/>
	</Target>

	<Target Name="Examples-Clean">
		<MSBuild Projects="$(Examples-Folder)\N2.Examples-vs2008.sln" Targets="Clean" />
		<MSBuild Projects="$(Examples-Folder)\N2.Examples-VisualBasic.sln" Targets="Clean" />

		<ItemGroup>
			<DependencyFolders Include="$(Examples-Folder)\MinimalCSharp\wwwroot\Edit\;
									    $(Examples-Folder)\MinimalVisualBasic\wwwroot\Edit\;
									    $(Examples-Folder)\Mvc\wwwroot\Edit\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\App_Browsers\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\App_GlobalResources\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\App_Themes\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\Templates\;
									    $(Examples-Folder)\TemplatesSite\wwwroot\Upload\;"/>
			<BinFiles Include="$(Examples-Folder)\**\bin\*" />
		</ItemGroup>
		<RemoveDir Directories="@(DependencyFolders)" />
		<Delete Files="@(BinFiles)" />
	</Target>

	<Target Name="Examples-CreateItemGroups">
		<ItemGroup>
			<ExampleSource-Exclude Include="$(Examples-Folder)\**\Edit\**\*;
											$(Examples-Folder)\**\.svn\**\*;
											$(Examples-Folder)\**\_*\**\*;
											$(Examples-Folder)\**\*WebSetup\**\*;
											$(Examples-Folder)\**\*VsTemplate\**\*;
											$(Examples-Folder)\**\obj\**\*;
											$(Examples-Folder)\**\PrecompiledWeb\**\*.*;
											$(Examples-Folder)\**\Ankh.Load;
											$(Examples-Folder)\**\*.sln.cache;
											$(Examples-Folder)\**\*.suo;
											$(Examples-Folder)\**\*.resharper;
											$(Examples-Folder)\**\*.user;
											$(Examples-Folder)\**\bin\Debug\*.*;
											$(Examples-Folder)\**\bin\Release\*.*;
											$(Examples-Folder)\**\*.pdb;
											$(Examples-Folder)\**\*WithProjectReferences.*" />

			<ExampleSource-CSFiles Include="$(Examples-CSharp)\**\*.*" Exclude="@(ExampleSource-Exclude)" />
			<ExampleSource-VBFiles Include="$(Examples-VisualBasic)\**\*.*" Exclude="@(ExampleSource-Exclude)" />
			<ExampleSource-TemplatesSiteFiles Include="$(Examples-TemplatesSiteFolder)\**\*.*" Exclude="@(ExampleSource-Exclude)" />
			<ExampleSource-MvcFiles Include="$(Examples-MvcFolder)\**\*.*" Exclude="@(ExampleSource-Exclude)" />
		</ItemGroup>
	</Target>

	<Target Name="Examples-Deploy" DependsOnTargets="Examples-CreateItemGroups">
		<Message Text="Deploying Examples"/>

		<CreateItem Include="$(DeployFolder)\Framework\**\*" Exclude="$(DeployFolder)\Framework\*.txt">
			<Output TaskParameter="Include" ItemName="FrameworkDeploy-ForExampleDeploy"/>
		</CreateItem>

		<Copy SourceFiles="@(ExampleSource-VBFiles)" DestinationFolder="$(Deploy-ExamplesFolder)\VB\%(RecursiveDir)" />
		<Copy SourceFiles="@(Framework-BinFiles)"         DestinationFolder="$(Deploy-ExamplesFolder)\VB\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)"        DestinationFolder="$(Deploy-ExamplesFolder)\VB\wwwroot\Edit\%(RecursiveDir)" />
		<Copy SourceFiles="@(TextFiles)"             DestinationFolder="$(Deploy-ExamplesFolder)\VB" />

		<Copy SourceFiles="@(ExampleSource-CSFiles)" DestinationFolder="$(Deploy-ExamplesFolder)\CS\%(RecursiveDir)" />
		<Copy SourceFiles="@(Framework-BinFiles)"         DestinationFolder="$(Deploy-ExamplesFolder)\CS\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)"        DestinationFolder="$(Deploy-ExamplesFolder)\CS\wwwroot\Edit\%(RecursiveDir)" />
		<Copy SourceFiles="@(TextFiles)"             DestinationFolder="$(Deploy-ExamplesFolder)\CS" />
		<Copy SourceFiles="@(Snippets)"              DestinationFolder="$(Deploy-ExamplesFolder)\CS\Snippets" />

		<Copy SourceFiles="@(ExampleSource-TemplatesSiteFiles)" DestinationFolder="$(Deploy-ExamplesFolder)\TemplatesSite\%(RecursiveDir)" />
		<Copy SourceFiles="@(TextFiles)"                        DestinationFolder="$(Deploy-ExamplesFolder)\TemplatesSite" />
		<Copy SourceFiles="@(Snippets)"                         DestinationFolder="$(Deploy-ExamplesFolder)\TemplatesSite\Snippets" />
		<Copy SourceFiles="@(FrameworkDeploy-ForExampleDeploy)"      DestinationFolder="$(Deploy-ExamplesFolder)\Mvc\wwwroot\%(RecursiveDir)" />

		<Copy SourceFiles="@(ExampleSource-MvcFiles)"       DestinationFolder="$(Deploy-ExamplesFolder)\Mvc\%(RecursiveDir)" />
		<Copy SourceFiles="@(Framework-BinFiles)"                DestinationFolder="$(Deploy-ExamplesFolder)\Mvc\wwwroot\Bin" />
		<Copy SourceFiles="@(Framework-EditFiles)"               DestinationFolder="$(Deploy-ExamplesFolder)\Mvc\wwwroot\Edit\%(RecursiveDir)" />
		<Copy SourceFiles="@(TextFiles)"                    DestinationFolder="$(Deploy-ExamplesFolder)\Mvc" />
		<Copy SourceFiles="@(Snippets)"                     DestinationFolder="$(Deploy-ExamplesFolder)\Mvc\Snippets" />
	</Target>
</Project>